<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile Management</title>
    <link rel="icon" type="image/svg+xml" href="../../assets/logo.png" />
    <link href="../styles/output.css" rel="stylesheet" />
    <link href="../styles/styles.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>

    <!--Awsome notifications-->
  <script src="../javascript/index.var.js"></script>
  <link rel="stylesheet" href="../styles/style.css">


  <style>
    .token-wrap {
      word-wrap: break-word;
      max-width: 100%;
    }

    /* Loader styles */
    #loader {
      border: 4px solid #f3f3f3;
      border-radius: 50%;
      border-top: 4px solid #3498db;
      width: 25px;
      height: 25px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }
  </style>
</head>

<body>
  <script type="module">

    let notifier = new AWN();

    // notifier.success('Success message', {durations: {success: 10000}})
    //notifier.success("Accept states cannot have outgoing edges. Remove any outgoing edges from this state first.", { durations: { info: 10000 }, labels: { success: "Oops!" } });



    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging.js";


    const firebaseConfig = {
      apiKey: "AIzaSyBA-red8RszDmGY3YGELrunZQxFmg7r04Y",
      authDomain: "campus-safety-fcm.firebaseapp.com",
      projectId: "campus-safety-fcm",
      storageBucket: "campus-safety-fcm.appspot.com",
      messagingSenderId: "221773083535",
      appId: "1:221773083535:web:0500a94bbb7a9dd6b891fa",
      measurementId: "G-8BZHJT3BRY"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const messaging = getMessaging(app);

    function playSound() {
      //Play browser notifcation sound
      const audio = new Audio("../assets/notification.mp3");
      audio.play().catch(error => {
        console.log("Failed to play the notification sound: ", error);
      });
    }

    // Handle incoming messages when the app is in the foreground
    onMessage(messaging, (payload) => {
      console.log('Message received. ', payload);

      // Access custom data
      const notificationType = payload.data.notificationType;
      const sender = payload.data.sender;
      const senderLocation = payload.data.senderLocation;

      // Access notification payload
      const notificationTitle = payload.notification.title;
      const notificationBody = payload.notification.body;

      let detailedMessage = notificationBody;  // Base notification body

      // Customize the message based on the notificationType with HTML tags for emphasis
      if (notificationType === "emergency-alert") {
        detailedMessage = `<strong>Emergency-alert</strong> from <strong>${sender}</strong>: <br/>${notificationBody}`;
        notifier.alert(detailedMessage, { durations: { alert: 20000 }, labels: { alert: notificationTitle } });
        playSound();

      } else if (notificationType === "announcement") {
        detailedMessage = `<strong>Announcement</strong> from <strong>${sender}</strong>: <br/>${notificationBody}`;
        notifier.success(detailedMessage, { durations: { success: 20000 }, labels: { success: notificationTitle } });
        playSound();

      } else {
        // Default notification handling with styled message
        detailedMessage = `Notification from <strong>${sender}</strong>: ${notificationBody}`;
        notifier.info(detailedMessage, { durations: { info: 20000 }, labels: { info: notificationTitle } });
        playSound();
      }

      // Log the custom data for debugging or further processing
      console.log(`Notification Type: ${notificationType}`);
      console.log(`Sender: ${sender}`);
      console.log(`Sender Location: ${senderLocation}`);
    });



  </script>

  <div class="flex flex-col min-h-screen bg-gray-100">
    <div id="">
      <header class="bg-[#015EB8] text-white p-4 flex justify-between items-center">
        <div class="flex items-center">
          <a href="/admin"><img src="../assets/logo.png" alt="Campus Safety Logo" class="h-8 mr-2"></a>
          <a href="/admin" class="text-xl font-semibold md:block">Campus Safety</a>
        </div>
        <div class="flex items-center space-x-4">

          <div class="relative inline-flex" id="notificationContainer">

            <button id="notificationButton"
              class="flex rounded-md bg-[#FDB913] py-2 px-4 border border-transparent text-center text-sm text-white transition-all shadow-md hover:shadow-lg focus:bg-slate-700 focus:shadow-none active:bg-slate-700 hover:bg-slate-700 active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none"
              type="button">
              Notifications
              <img src="../assets/bell-ring.png" alt="Notifications" class="h-5 md:h-6 md:mr-2">
            </button>
            <span id="notificationBadge"
              class="absolute top-0.5 right-0.5 grid min-h-[24px] min-w-[24px] translate-x-2/4 -translate-y-2/4 place-items-center rounded-full bg-[white] py-1 px-1 text-xs text-black">
              5
            </span>
            <div id="dropdownMenu"
              class="absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg z-10 border border-gray-200 hidden">
              <div class="py-2" id="notificationList">
                <!-- Notifications will be inserted here -->
              </div>
            </div>
          </div>

          <a id="profileBtn" href="/admin/profileManagement" class="rounded-full flex items-center">
            <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-white">
              <img src="../assets/user-profile.png" alt="User Profile" class="w-full h-full object-cover"
                id="headerProfilePic">
            </div>
          </a>
        </div>
      </header>
    </div>
    <div class="flex flex-1">
      <div id="">
        <!-- Desktop Navigation -->
        <nav class="hidden h-full md:flex bg-white w-64 p-4 flex-col shadow-md">
          <ul class="flex-1 space-y-2">
            <li>
              <a href="/admin" class="flex items-center text-gray-700 hover:bg-gray-300 p-2 rounded-md">
                <img src="../assets/dashboard.png" alt="Dashboard" class="h-6 w-6 mr-3">
                <span class="font-medium">Dashboard</span>
              </a>
            </li>
            <li>
              <a href="/admin/viewIncidents" class="flex items-center text-gray-700 hover:bg-gray-300 p-2 rounded-md">
                <img src="../assets/report.png" alt="View Incidents" class="h-6 w-6 mr-3">
                <span class="font-medium">View Incidents</span>
              </a>
            </li>
            <li>
              <a href="/admin/sendNotifications"
                class="flex items-center text-gray-700 hover:bg-gray-300 p-2 rounded-md">
                <img src="../assets/alert.png" alt="Send Notifications" class="h-6 w-6 mr-3">
                <span class="font-medium">Send Notifications</span>
              </a>
            </li>
            <li>
              <a href="/admin/safetyResources" class="flex items-center text-gray-700 hover:bg-gray-300 p-2 rounded-md">
                <img src="../assets/resources.png" alt="Safety Resources" class="h-6 w-6 mr-3">
                <span class="font-medium">Safety Resources</span>
              </a>
            </li>
            <li>
              <a href="/admin/generateCode" class="flex items-center text-gray-700 hover:bg-gray-300 p-2 rounded-md">
                <img src="../assets/password-entry.png" alt="Generate Code" class="h-6 w-6 mr-3">
                <span class="font-medium">Generate Code</span>
              </a>
            </li>
            <li>
              <a href="/admin/emergencyAlerts" class="flex items-center text-gray-700 hover:bg-gray-300 p-2 rounded-md">
                <img src="../assets/caution.png" alt="Generate Code" class="h-6 w-6 mr-3">
                <span class="font-medium">Manage Emergencies</span>
              </a>
            </li>
          </ul>
          <div class="border-t border-gray-200 pt-4 mt-4">
            <a href="/auth/logout" class="flex items-center text-gray-700 hover:bg-gray-300 p-2 rounded-md"
              id="logoutButton">
              <img src="../assets/logout-solid.png" alt="Logout" class="h-6 w-6 mr-3">
              <span class="font-medium">Logout</span>
            </a>
          </div>
        </nav>

        <!-- Mobile Navigation -->
        <nav
          class="fixed inset-x-0 bottom-0 bg-[#015EB8] text-white p-4 flex justify-around items-center md:hidden z-50">
          <a href="/admin/viewIncidents" class="flex flex-col items-center">
            <img src="../assets/report-mobile.png" alt="View Incidents" class="h-7 w-7">
            <span class="text-xs mt-1">Incidents</span>
          </a>
          <a href="/admin/sendNotifications" class="flex flex-col items-center">
            <img src="../assets/alert-mobile.png" alt="Send Notifications" class="h-7 w-7">
            <span class="text-xs mt-1">Notify</span>
          </a>
          <a href="/admin" class="flex flex-col items-center">
            <img src="../assets/dashboard-mobile.png" alt="Dashboard" class="h-7 w-7">
            <span class="text-xs mt-1">Dashboard</span>
          </a>
          <a href="/admin/safetyResources" class="flex flex-col items-center">
            <img src="../assets/resources-mobile.png" alt="Safety Resources" class="h-7 w-7">
            <span class="text-xs mt-1">Resources</span>
          </a>
          <a href="/admin/generateCode" class="flex flex-col items-center">
            <img src="../assets/pick-code.png" alt="Generate Code" class="h-7 w-7">
            <span class="text-xs mt-1">Gen Code</span>
          </a>
          <a href="/admin/emergencyAlerts" class="flex flex-col items-center">
            <img src="../assets/caution-white.png" alt="Generate Code" class="h-7 w-7">
            <span class="text-xs mt-1">Emergencies</span>
          </a>
        </nav>
      </div>

      <main class="flex-1 p-6 overflow-auto flex items-center justify-center">
        <div class="w-full max-w-2xl h-full">
          <div
            class="bg-[#015EB8] text-white rounded-t-lg p-4 flex items-center space-x-4 relative border border-gray-200"
          >
            <div class="relative">
              <img
                id="avatar"
                src="../assets/user-profile.png"
                alt="User Profile"
                class="w-20 h-20 rounded-full border-2 border-white"
              />
              <button
                id="cameraButton"
                class="absolute bottom-0 right-0 bg-white text-[#015EB8] rounded-full p-2 hidden hover:bg-gray-200 transition-colors duration-200"
              >
                <img
                  src="../assets/add_a_photo.png"
                  alt="Add photo"
                  class="h-4 w-4"
                />
              </button>
              <input
                type="file"
                id="fileInput"
                class="hidden"
                accept="image/*"
              />
            </div>
            <div class="flex flex-col items-start">
              <h1 class="text-2xl" id="profileName">First Last</h1>
              <div class="flex items-center space-x-2 mt-1">
                <p
                  class="text-xs border border-white rounded-full px-2 py-0.5 hover:bg-white hover:text-[#015EB8] transition-colors duration-200"
                  id="profileRole"
                >
                  Admin
                </p>
              </div>
            </div>
          </div>
          <div
            class="p-4 bg-white rounded-b-lg flex-grow border border-gray-200 border-t-0"
          >
            <form id="profileForm" class="grid gap-4">
              <div
                id="messageContainer"
                class="hidden mb-4 p-4 rounded-md text-sm font-medium"
              ></div>
              <div class="grid gap-2">
                <label for="email" class="font-semibold">Email</label>
                <input
                  type="email"
                  id="email"
                  class="border p-2 rounded bg-blue-100 cursor-not-allowed"
                  readonly
                />
              </div>
              <div class="grid gap-2">
                <label for="cellphone" class="font-semibold"
                  >Cellphone Number</label
                >
                <input
                  type="text"
                  id="cellphone"
                  class="border p-2 rounded-md bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500"
                  disabled
                  placeholder="Enter your new cellphone number"
                />
              </div>
              <div id="editFields" class="hidden">
                <div class="grid gap-2">
                  <label for="password" class="font-semibold"
                    >New Password</label
                  >
                  <div class="relative">
                    <input
                      type="password"
                      id="password"
                      class="border p-2 rounded-md bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 w-full"
                      placeholder="Enter new password"
                    />
                    <button
                      type="button"
                      id="togglePassword"
                      class="absolute inset-y-0 right-0 pr-3 flex items-center"
                    >
                      <img
                        src="../assets/eye-close.png"
                        alt="Toggle password visibility"
                        class="h-5 w-5"
                      />
                    </button>
                  </div>
                </div>
                <div class="grid gap-2">
                  <label for="confirmPassword" class="font-semibold"
                    >Confirm Password</label
                  >
                  <div class="relative">
                    <input
                      type="password"
                      id="confirmPassword"
                      class="border p-2 rounded-md bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 w-full"
                      placeholder="Confirm new password"
                    />
                    <button
                      type="button"
                      id="toggleConfirmPassword"
                      class="absolute inset-y-0 right-0 pr-3 flex items-center"
                    >
                      <img
                        src="../assets/eye-close.png"
                        alt="Toggle password visibility"
                        class="h-5 w-5"
                      />
                    </button>
                  </div>
                </div>
              </div>
              <div class="grid gap-2">
                <label class="font-semibold">Date Joined</label>
                <input
                  type="text"
                  value="2024-09-06"
                  class="border p-2 rounded bg-blue-100 cursor-not-allowed"
                  readonly
                />
              </div>
              <button
                type="button"
                class="bg-[#015EB8] text-white p-2 rounded w-full hover:bg-[#014C93]"
                id="submitButton"
              >
                Edit Profile
              </button>
            </form>
            <a href="/auth/logout" id="logoutButton">
            <button
              class="mt-4 bg-red-600 text-white p-2 rounded w-full hover:bg-red-700 transition-colors duration-200 md:hidden"
            >
              Logout
            </button>
            </a>
          </div>
        </div>
      </main>
    </div>
    <footer class="bg-[#015EB8] text-white p-4 text-center">
      <p>&copy; 2024 Campus Safety App. All rights reserved.</p>
    </footer>
  </body>

  <script src="../javascript/profileManagement.js"></script>
  <script src="../javascript/headerFunctionality.js"></script>
</html>
