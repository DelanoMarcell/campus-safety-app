<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Campus Safety App</title>
    <link rel="icon" type="image/svg+xml" href="../../assets/logo.png" />
    <link href="../styles/output.css" rel="stylesheet" />
    <link href="../styles/styles.css" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="../javascript/loadComponents.js" defer></script>
    <style>
        #map {
            height: 650px;
            width: 100%;
            display: block;
        }

        /* Loader styles */
        #mapLoader {
            display: none;
            border: 4px solid #f3f3f3;
            border-radius: 50%;
            border-top: 4px solid #3498db;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
    </style>
</head>


<body class="flex flex-col min-h-screen bg-gray-100">
    <div id="header-placeholder"></div>
    <div class="flex flex-1">
        <div id="navbar-placeholder"></div>

        <!-- Main Content -->
        <main class="flex-1 p-6 overflow-auto">

            <div class="flex flex-col bg-gray-200 rounded-lg border border-gray-400 p-4 mx-20 max-sm:mx-0">
                <h2 class="text-center text-2xl font-bold mb-6 max-sm:text-xl">Location Services</h2>
                <!-- <div class="alert-box mb-4" id="alert" role="alert">Test Error</div> -->
                <!-- map here -->
                <div id="map"></div>
            </div>
        </main>
    </div>
    <div id="footer-placeholder"></div>

    <script>
        let mapInitialized = false;

        function initMap() {
            // Check if browser supports Geolocation API
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    function (position) {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        initializeMap(userLocation); // Initialize map to current location
                    },
                    function () {
                        const defaultLocation = { lat: -26.11, lng: 28.01 }; // Fallback location
                        initializeMap(defaultLocation);
                    }
                );
            } else {
                // If browser doesn't support Geolocation, use default location
                const defaultLocation = { lat: -26.11, lng: 28.01 };
                initializeMap(defaultLocation);
            }
        }

        function initializeMap(location) {
            if (mapInitialized) return; // Prevent reinitializing the map

            // Initialize Google Map centered at the user's location
            const map = new google.maps.Map(document.getElementById("map"), {
                zoom: 16,
                center: location
            });

            // Add a draggable marker at the user's location
            const marker = new google.maps.Marker({
                position: location,
                map: map,
                draggable: false
            });

            // Set up event listeners for marker drag and map click
            google.maps.event.addListener(marker, 'dragend', function (event) {
                console.log('Marker moved to:', event.latLng.lat(), event.latLng.lng());
            });

            google.maps.event.addListener(map, 'click', function (event) {
                marker.setPosition(event.latLng); // Move marker to new position
                console.log('Map clicked at:', event.latLng.lat(), event.latLng.lng());
            });

            mapInitialized = true; // Flag to prevent reinitialization
        }

        // Initialize the map on page load
        window.onload = initMap;
    </script>

    <!-- Load Google Maps API -->
    <script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAmnz9yP1MewDeyOE-OV92JrAclq18JzZ4&loading=async&callback=initMap">
        </script>

</body>

</html>