<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Safety Resources</title>
    <link rel="icon" type="image/svg+xml" href="../../assets/logo.png" />
    <link href="../styles/styles.css" rel="stylesheet">
    <link href="../styles/output.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!--Awsome notifications-->
    <script src="../javascript/index.var.js"></script>
    <link rel="stylesheet" href="../styles/style.css">
    <style>
        /* Modal styles */
        .modal {
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            max-width: 500px;
            width: 100%;
            position: relative;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body class="flex flex-col min-h-screen bg-gray-100">
    <script type="module">
        let notifier = new AWN();

        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getMessaging, getToken, onMessage } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBA-red8RszDmGY3YGELrunZQxFmg7r04Y",
            authDomain: "campus-safety-fcm.firebaseapp.com",
            projectId: "campus-safety-fcm",
            storageBucket: "campus-safety-fcm.appspot.com",
            messagingSenderId: "221773083535",
            appId: "1:221773083535:web:0500a94bbb7a9dd6b891fa",
            measurementId: "G-8BZHJT3BRY"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const messaging = getMessaging(app);

        function playSound() {
            const audio = new Audio("../assets/notification.mp3");
            audio.play().catch(error => {
                console.log("Failed to play the notification sound: ", error);
            });
        }

        // Handle incoming messages when the app is in the foreground
        onMessage(messaging, (payload) => {
            console.log('Message received. ', payload);

            const notificationType = payload.data.notificationType;
            const sender = payload.data.sender;
            const senderLocation = payload.data.senderLocation;
            const notificationTitle = payload.notification.title;
            const notificationBody = payload.notification.body;

            let detailedMessage = notificationBody;

            if (notificationType === "emergency-alert" && recipient != "admin") {
                detailedMessage = `<strong>Emergency-alert</strong> from <strong>${sender}</strong>: <br/>${notificationBody}`;
                notifier.alert(detailedMessage, { durations: { alert: 20000 }, labels: { alert: notificationTitle } });
                playSound();
            } else if (notificationType === "announcement") {
                detailedMessage = `<strong>Announcement</strong> from <strong>${sender}</strong>: <br/>${notificationBody}`;
                notifier.success(detailedMessage, { durations: { success: 20000 }, labels: { success: notificationTitle } });
                playSound();
            }

            console.log(`Notification Type: ${notificationType}`);
            console.log(`Sender: ${sender}`);
            console.log(`Sender Location: ${senderLocation}`);
        });
    </script>

    <div id="header-placeholder">
        <header class="bg-[#015EB8] text-white p-4 flex justify-between items-center">
            <div class="flex items-center">
                <a href="/user"><img src="../assets/logo.png" alt="Campus Safety Logo" class="h-8 mr-2"></a>
                <a href="/user" class="text-xl font-semibold md:block">Campus Safety</a>
            </div>
            <div class="flex items-center space-x-4">
                <div class="relative inline-flex" id="panicContainer">
                    <button id="panicButton"
                        class="flex rounded-md bg-red-600 py-2 px-4 border border-transparent text-center text-sm text-white transition-all shadow-md hover:shadow-lg focus:bg-slate-700 focus:shadow-none active:bg-slate-700 hover:bg-slate-700 active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none"
                        type="button">
                        Panic
                        <img src="../assets/danger.png" alt="Notifications" class="h-5 md:h-6 md:mr-2">
                    </button>
                    <div id="dropdownMenupanic"
                        class="absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg z-10 border border-gray-200 hidden">
                    </div>
                </div>

                <div class="relative inline-flex" id="notificationContainer">
                    <button id="notificationButton"
                        class="flex rounded-md bg-[#FDB913] py-2 px-4 border border-transparent text-center text-sm text-white transition-all shadow-md hover:shadow-lg focus:bg-slate-700 focus:shadow-none active:bg-slate-700 hover:bg-slate-700 active:shadow-none disabled:pointer-events-none disabled:opacity-50 disabled:shadow-none"
                        type="button">
                        Notifications
                        <img src="../assets/bell-ring.png" alt="Notifications" class="h-5 md:h-6 md:mr-2">
                    </button>
                    <span id="notificationBadge"
                        class="absolute top-0.5 right-0.5 grid min-h-[24px] min-w-[24px] translate-x-2/4 -translate-y-2/4 place-items-center rounded-full bg-[white] py-1 px-1 text-xs text-black">
                        0
                    </span>
                    <div id="dropdownMenu"
                        class="absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg z-10 border border-gray-200 hidden">
                        <div class="py-2" id="notificationList">
                        </div>
                    </div>
                </div>

                <a id="profileBtn" href="/user/profileManagement" class="rounded-full flex items-center">
                    <div class="w-10 h-10 rounded-full overflow-hidden border-2 border-white">
                        <img src="../assets/user-profile.png" alt="User Profile" class="w-full h-full object-cover"
                            id="headerProfilePic">
                    </div>
                </a>
            </div>
        </header>
    </div>

    <div class="flex flex-1">
        <div id="navbar-placeholder">
            <nav class="hidden h-full md:flex bg-white w-64 p-4 flex-col shadow-md">
                <ul class="flex-1 space-y-2">
                    <li>
                        <a href="/user" class="flex items-center text-gray-700 hover:bg-gray-300 p-2 rounded-md">
                            <img src="../assets/dashboard.png" alt="Dashboard" class="h-6 w-6 mr-3">
                            <span class="font-medium">Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="/user/reportIncident"
                            class="flex items-center text-gray-700 hover:bg-gray-300 p-2 rounded-md">
                            <img src="../assets/report.png" alt="Report Incident" class="h-6 w-6 mr-3">
                            <span class="font-medium">Report Incident</span>
                        </a>
                    </li>
                    <li>
                        <a href="/user/viewNotifications"
                            class="flex items-center text-gray-700 hover:bg-gray-300 p-2 rounded-md">
                            <img src="../assets/alert.png" alt="Emergency Alerts" class="h-6 w-6 mr-3">
                            <span class="font-medium">View Notifications</span>
                        </a>
                    </li>
                    <li>
                        <a href="/user/safetyResources"
                            class="flex items-center text-gray-700 hover:bg-gray-300 p-2 rounded-md">
                            <img src="../assets/resources.png" alt="Safety Resources" class="h-6 w-6 mr-3">
                            <span class="font-medium">Safety Resources</span>
                        </a>
                    </li>
                    <li>
                        <a href="/user/campusNavigation"
                            class="flex items-center text-gray-700 hover:bg-gray-300 p-2 rounded-md">
                            <img src="../assets/location.png" alt="Safety Resources" class="h-6 w-6 mr-3">
                            <span class="font-medium">Campus Navigation</span>
                        </a>
                    </li>
                </ul>
                <div class="border-t border-gray-200 pt-4 mt-4">
                    <a href="/auth/logout" class="flex items-center text-gray-700 hover:bg-gray-300 p-2 rounded-md"
                        id="logoutButton">
                        <img src="../assets/logout-solid.png" alt="Logout" class="h-6 w-6 mr-3">
                        <span class="font-medium">Logout</span>
                    </a>
                </div>
            </nav>

            <!-- Mobile Navigation -->
            <nav
                class="fixed inset-x-0 bottom-0 bg-[#015EB8] text-white p-4 flex justify-around items-center md:hidden z-50">
                <a href="/user/reportIncident" class="flex flex-col items-center">
                    <img src="../assets/report-mobile.png" alt="Report Incident" class="h-8 w-8">
                    <span class="text-xs mt-1">Report</span>
                </a>
                <a href="/user/viewNotifications" class="flex flex-col items-center">
                    <img src="../assets/alert-mobile.png" alt="Emergency Alerts" class="h-8 w-8">
                    <span class="text-xs mt-1">Alerts</span>
                </a>
                <a href="/user" class="flex flex-col items-center">
                    <img src="../assets/dashboard-mobile.png" alt="Dashboard" class="h-8 w-8">
                    <span class="text-xs mt-1">Dashboard</span>
                </a>
                <a href="/user/safetyResources" class="flex flex-col items-center">
                    <img src="../assets/resources-mobile.png" alt="Safety Resources" class="h-8 w-8">
                    <span class="text-xs mt-1">Resources</span>
                </a>
                <a href="/user/campusNavigation" class="flex flex-col items-center">
                    <img src="../assets/location-mobile.png" alt="Campus Navigation" class="h-8 w-8">
                    <span class="text-xs mt-1">Navigation</span>
                </a>
            </nav>
        </div>

        <main class="flex-1 p-6 overflow-auto">
            <div class="text-center mb-4">
                <h2 class="text-3xl font-semibold text-gray-800">Safety Resources</h2>
                <p class="text-gray-400 mt-2">Access important safety information and resources.</p>
            </div>

            <div class="relative w-full h-full overflow-y-auto py-6">
                <div id="carousel" class="flex flex-col space-y-6 items-center">
                    <!-- Dynamic safety resources will be inserted here -->
                </div>
            </div>
        </main>
    </div>

    <footer class="bg-[#015EB8] text-white p-4 text-center">
        <p>&copy; 2024 Campus Safety App. All rights reserved.</p>
    </footer>

    <script src="../javascript/userSafetyResources.js"></script>
    <script src="../javascript/headerFunctionality.js"></script>
</body>

</html>